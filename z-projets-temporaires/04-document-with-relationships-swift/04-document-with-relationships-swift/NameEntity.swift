//-----------------------------------------------------------------------------*
//                                                                             *
//                          File 'NameEntity.swift'                            *
//                     Generated by version 0.0.1 [debug]                      *
//                       august 7th, 2014, at 17h58'40"                        *
//                                                                             *
//-----------------------------------------------------------------------------*

//--- START OF USER ZONE 1


//--- END OF USER ZONE 1

import Cocoa

//---------------------------------------------------------------------------------------------------------------------*

@objc(NameEntity) class NameEntity : PMManagedObject {

  //-------------------------------------------------------------------------------------------------------------------*
  //    Attribute: name                                                                                                *
  //-------------------------------------------------------------------------------------------------------------------*

  var name__explorer : NSTextField?
  var name_observers = NSMutableSet ()

  var name : String =  "Name" {
    willSet {
      undoManager ().registerUndoWithTarget (self, selector:"setName:", object:name)
    }
    didSet {
      name__explorer?.stringValue = name
    //--- Notify observers
      for anyObject in name_observers.allObjects {
        let object = anyObject as PMTriggerProtocol
        enterTriggerWithObject (object)
      }
    }
  }

  func addObserverOf_name (inObserver : PMTriggerProtocol) {
    name_observers.addObject (inObserver)
    enterTriggerWithObject (inObserver)
  }

  func removeObserverOf_name (inObserver : PMTriggerProtocol) {
    name_observers.removeObject (inObserver)
    enterTriggerWithObject (inObserver)
  }
  
  //-------------------------------------------------------------------------------------------------------------------*
  //    Attribute: aValue                                                                                              *
  //-------------------------------------------------------------------------------------------------------------------*

  var aValue__explorer : NSTextField?
  var aValue_observers = NSMutableSet ()

  func undo_aValue (number : NSNumber) {
    aValue = number.longLongValue
  }
  
  var aValue : Int64 =  123 {
    willSet {
      undoManager ().registerUndoWithTarget (self,
        selector:"undo_aValue:",
        object:NSNumber (longLong:aValue)
      )
    }
    didSet {
      if (aValue__explorer != nil) {
        aValue__explorer!.stringValue = NSString (format:"%lld", aValue)
      }
    //--- Notify observers
      for anyObject in aValue_observers.allObjects {
        let object = anyObject as PMTriggerProtocol
        enterTriggerWithObject (object)
      }
    }
  }

  func addObserverOf_aValue (inObserver : PMTriggerProtocol) {
    aValue_observers.addObject (inObserver)
    enterTriggerWithObject (inObserver)
  }

  func removeObserverOf_aValue (inObserver : PMTriggerProtocol) {
    aValue_observers.removeObject (inObserver)
    enterTriggerWithObject (inObserver)
  }
  
  //-------------------------------------------------------------------------------------------------------------------*
  //    To one relationship: mRoot                                                                                     *
  //-------------------------------------------------------------------------------------------------------------------*

  var mRoot_observers = NSMutableSet ()
  var mRoot__explorer : NSButton?
  
  func undo_mRoot (v : MyRootEntity?) {
    mRoot = v
  }
  
  weak var mRoot : MyRootEntity? = nil {
    didSet {
      let isLoading = (mEntityManager != nil) ? mEntityManager!.isLoading () : false
      if oldValue !== mRoot && !isLoading {
      //--- Register old value in undo manager
        undoManager ().registerUndoWithTarget (self, selector:"undo_mRoot:", object:oldValue)
      //--- Update explorer
        if mRoot__explorer != nil {
          updateManagedObjectToOneRelationshipDisplayForKey ("mRoot", button:mRoot__explorer!)
        }
      //--- Reset old opposite relation ship
        if let unwrappedOldValue = oldValue {
          let idx = unwrappedOldValue.mNames.indexOfObjectIdenticalTo (self)
          if idx != NSNotFound {
            var array = unwrappedOldValue.mNames.mutableCopy () as NSMutableArray
            array.removeObjectAtIndex (idx)
            unwrappedOldValue.mNames = array
          }
        }
      //--- Set new opposite relation ship
        if let root = mRoot {
          let idx = root.mNames.indexOfObjectIdenticalTo (self)
          if idx == NSNotFound {
            var array = root.mNames.mutableCopy () as NSMutableArray
            array.addObject (self)
            root.mNames = array
          }
        }
      //--- Notify observers
        for anyObject in mRoot_observers {
          let object = anyObject as PMTriggerProtocol
          enterTriggerWithObject (object)
        }
      }
    }
  }
   
  func addObserverOf_mRoot (inObserver : PMTriggerProtocol) {
    mRoot_observers.addObject (inObserver)
    enterTriggerWithObject (inObserver)
  }

  func removeObserverOf_mRoot (inObserver : PMTriggerProtocol) {
    mRoot_observers.removeObject (inObserver)
    enterTriggerWithObject (inObserver)
  }

  //-------------------------------------------------------------------------------------------------------------------*
  //    init                                                                                                           *
  //-------------------------------------------------------------------------------------------------------------------*

  override init (entityManager : PMObjectManager) {
    super.init (entityManager:entityManager)
  //--- Register trigger objects
  }

  //-------------------------------------------------------------------------------------------------------------------*
  //    deinit                                                                                                         *
  //-------------------------------------------------------------------------------------------------------------------*

  deinit {
  //--- remove trigger objects
  }

  //-------------------------------------------------------------------------------------------------------------------*
  //    populateExplorerWindow                                                                                         *
  //-------------------------------------------------------------------------------------------------------------------*

  override func populateExplorerWindowWithRect (inout ioRect : NSRect, view : NSView) {
    name__explorer = createEntryForAttributeNamed ("name", ioRect:&ioRect, view:view)
    if (name__explorer != nil) {
      name__explorer!.stringValue = name
    }
    aValue__explorer = createEntryForAttributeNamed ("aValue", ioRect:&ioRect, view:view)
    if (aValue__explorer != nil) {
      aValue__explorer!.stringValue = NSString (format:"%lld", aValue)
    }
   mRoot__explorer = createEntryForToOneRelationshipNamed ("mRoot", ioRect: &ioRect, view: view)
   updateManagedObjectToOneRelationshipDisplayForKey ("mRoot",button:mRoot__explorer!)
  }

  //-------------------------------------------------------------------------------------------------------------------*
  //    clearObjectExplorer                                                                                            *
  //-------------------------------------------------------------------------------------------------------------------*

  override func clearObjectExplorer () {
    name__explorer = nil
    aValue__explorer = nil
    mRoot__explorer = nil
    super.clearObjectExplorer ()
  }

  //-------------------------------------------------------------------------------------------------------------------*
  //    saveIntoDictionary                                                                                             *
  //-------------------------------------------------------------------------------------------------------------------*

  override func saveIntoDictionary (ioDictionary : NSMutableDictionary) {
    super.saveIntoDictionary (ioDictionary)
    ioDictionary.setValue (name, forKey: "name")
    ioDictionary.setValue (NSNumber (longLong:aValue), forKey: "aValue")
//    storeEntityInDictionary (mRoot, inRelationshipName:"mRoot", ioDictionary:ioDictionary) ;
  }

  //-------------------------------------------------------------------------------------------------------------------*
  //    setUpWithDictionary                                                                                            *
  //-------------------------------------------------------------------------------------------------------------------*

  override func setUpWithDictionary (inDictionary : NSDictionary,
                                     managedObjectArray : NSArray) {
    super.setUpWithDictionary (inDictionary, managedObjectArray:managedObjectArray)
    name = inDictionary.readString ("name")
    aValue = inDictionary.readInt64 ("aValue")
  }

  //-------------------------------------------------------------------------------------------------------------------*
  //   accessibleObjects                                                                                               *
  //-------------------------------------------------------------------------------------------------------------------*

  override func accessibleObjects (inout objects : NSMutableArray) {
    super.accessibleObjects (&objects)
    if mRoot != nil {
      objects.addObject (mRoot!)
    }
  }

  //-------------------------------------------------------------------------------------------------------------------*

}

//--- START OF USER ZONE 2


//--- END OF USER ZONE 2


