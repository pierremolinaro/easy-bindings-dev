
import Cocoa

//---------------------------------------------------------------------------------------------------------------------*

@objc(%!DOCUMENT_NAME%) class %!DOCUMENT_NAME% : PMManagedDocument, PMUserClassName {

  //-------------------------------------------------------------------------------------------------------------------*
  //    Outlets                                                                                                        *
  //-------------------------------------------------------------------------------------------------------------------*

%
for () in OUTLET_GENERATION_MAP do
%  @IBOutlet var %!lkey.string% : %!mOutletTypeName.string%?\n%
end
%
  //-------------------------------------------------------------------------------------------------------------------*
  //    Properties                                                                                                     *
  //-------------------------------------------------------------------------------------------------------------------*

%
for () in ATTRIBUTE_LIST do
%  var %!mAttributeName% = PMEntityProperty <%![mAttributeType swiftTypeName]%> (%!mDefaultValueInSwift%)\n%
end


%
  //-------------------------------------------------------------------------------------------------------------------*
  //    Transient properties                                                                                           *
  //-------------------------------------------------------------------------------------------------------------------*

%

for () in TRANSIENT_LIST_FOR_IMPLEMENTATION do
%  var %!mTransientName% = PMTransientProperty_%![mTransientType swiftTypeName]
                      % (PMTransientIndex.k_%
                      !["document." + DOCUMENT_NAME + "." + mTransientName identifierRepresentation]
                      %)\n%
end

%
  //-------------------------------------------------------------------------------------------------------------------*
  //    windowNibName                                                                                                  *
  //-------------------------------------------------------------------------------------------------------------------*

  override var windowNibName: String {
    return "%!DOCUMENT_NAME%"
  }

  //-------------------------------------------------------------------------------------------------------------------*
  //    rootEntityClassName                                                                                            *
  //-------------------------------------------------------------------------------------------------------------------*

  override func rootEntityClassName () -> String {
    return "%!ROOT_ENTITY_NAME%"
  }

  //-------------------------------------------------------------------------------------------------------------------*
  //    rootObject                                                                                                     *
  //-------------------------------------------------------------------------------------------------------------------*

  var rootObject : MyRootEntity { get { return mRootObject as! %!ROOT_ENTITY_NAME% } }

%
for () in ARRAY_CONTROLLER_LIST do
%  //-------------------------------------------------------------------------------------------------------------------*
  //    %!["Array controller: " + mControllerName stringByRightPadding !111 !' ']%*
  //-------------------------------------------------------------------------------------------------------------------*
  
  private var %!mControllerName% : ArrayController_%!mObjectTypeName%_%!mTomanyRelationshipName%? = nil

  func document_2E_PMDocument_2E_%!mControllerName%_noteDidChange () {
    %!mControllerName%?.modelDidChange ()
  }

  func document_2E_PMDocument_2E_%!mControllerName%_trigger () {
    %!mControllerName%?.display ()
  }

%
end
%  //-------------------------------------------------------------------------------------------------------------------*
  //    windowControllerDidLoadNib                                                                                     *
  //-------------------------------------------------------------------------------------------------------------------*

  override func windowControllerDidLoadNib (aController: NSWindowController) {
  //--------------------------- Outlet checking
%

for () in OUTLET_GENERATION_MAP do
   %    if nil == %!lkey.string% {\n%
   %      presentErrorWindow (__FILE__, __LINE__, "the '%!lkey.string%' outlet is nil") ;\n%
   %    }else if !%!lkey.string%!.isKindOfClass (%!mOutletTypeName.string%) {\n%
   %      presentErrorWindow (__FILE__, __LINE__, "the '%!lkey.string%' outlet is not an instance of '%!mOutletTypeName.string%'") ;\n%
   %    }\n%
end
%  //--------------------------- Array controller
%
for () in ARRAY_CONTROLLER_LIST do
%    %!mControllerName% = ArrayController_%!mObjectTypeName%_%!mTomanyRelationshipName% (
      object:rootObject,
      tableView:%!mTableViewOutletName%,
      file:__FILE__,
      line:__LINE__
    )\n%
end
%  //--- Install compute functions for transients
%
for () in TRANSIENT_LIST_FOR_IMPLEMENTATION do
  %    %!mTransientName%.computeFunction = {return compute_%!DOCUMENT_NAME%_%!mTransientName% (%
  for () in mDependencyList
    do ![mDependency generateActualParameterForComputeFunction]
    between %, %
  end
  %)}\n%
end
%  //--- Install property observers for transients
%
for () in TRANSIENT_LIST_FOR_IMPLEMENTATION do
for () in mDependencyList do
%    %![mDependency generateAddObserverCall]% (%!mTransientName%.event, inTrigger:true)\n%
end
end
%  //--- Install bindings
%
for () in REGULAR_BINDINGS_GENERATION_LIST do
  %    %!mOutletName%?.bind_%!mBindingName% (%
  for () in mBoundObjectStringList do
    !mValue%, %
  end
  %file:__FILE__, line:__LINE__%!mBindingOptionsString%)\n%
end
%  //--------------------------- Array controller as observers
%
for () in ARRAY_CONTROLLER_LIST do
% //   rootObject.%!mTomanyRelationshipName%.addObserver (PMEvent_document_2E_PMDocument_2E_%!mControllerName% (object:self), inTrigger:true)\n%
end
%  //--------------------------- Set targets / actions
%for () in TARGET_ACTION_LIST do
%    %!mOutletName%?.target = %!mTargetName%\n%
%    %!mOutletName%?.action = "%!mActionName%:"\n%
end
%  //--------------------------- Update display
    super.windowControllerDidLoadNib (aController)
    flushOutletEvents ()
  }

  //-------------------------------------------------------------------------------------------------------------------*
  //   removeWindowController                                                                                          *
  //-------------------------------------------------------------------------------------------------------------------*

  override func removeWindowController (inWindowController : NSWindowController) {
  //--- Unbind
%
for () in REGULAR_BINDINGS_GENERATION_LIST do
  %    %!mOutletName%?.unbind_%!mBindingName% ()\n%
end
%  //--------------------------- Remove controllers
%
for () in ARRAY_CONTROLLER_LIST do
%    %!mControllerName%?.unregister ()\n%
end
%  //--------------------------- Remove targets / actions
%for () in TARGET_ACTION_LIST do
%    %!mOutletName%?.target = nil\n%
end
%  //---
    super.removeWindowController (inWindowController)
  }


//---------------------------------------------------------------------------------------------------------------------*

}

