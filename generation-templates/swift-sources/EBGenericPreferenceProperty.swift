//----------------------------------------------------------------------------------------------------------------------
//  THIS FILE IS GENERATED BY EASY BINDINGS, DO NOT MODIFY IT
//----------------------------------------------------------------------------------------------------------------------

import Cocoa

//----------------------------------------------------------------------------------------------------------------------
//   EBGenericPreferenceProperty <T>
//----------------------------------------------------------------------------------------------------------------------

final class EBGenericPreferenceProperty <T : EBPropertyProtocol> : EBGenericStoredProperty <T> {

  //····················································································································

  private var mPreferenceKey : String

  //····················································································································

  init (defaultValue inValue : T, prefKey inPreferenceKey : String) {
    self.mPreferenceKey = inPreferenceKey
    super.init (defaultValue: inValue, undoManager: nil)
  //--- Read from preferences
    let possibleValue = UserDefaults.standard.object (forKey: inPreferenceKey)
    if let value = possibleValue as? NSObject {
      setProp (T.convertFromNSObject (object: value))
    }
  }

  //····················································································································

  override func postEvent () {
    UserDefaults.standard.set (self.propval.convertToNSObject (), forKey: self.mPreferenceKey)
    super.postEvent ()
  }

  //····················································································································
  //  Façade
  //····················································································································

  private lazy var mFaçade = ReadWriteFaçade <T> (
    getter: { [weak self] in
      if let unwrappedSelf = self {
        return .single (unwrappedSelf.propval)
      }else{
        return .empty
      }
    },
    setter: { [weak self] in self?.setProp ($0) }
  )

  //····················································································································

  override var projectedValue : ReadWriteFaçade <T> { self.mFaçade }

  //····················································································································

}

//----------------------------------------------------------------------------------------------------------------------
