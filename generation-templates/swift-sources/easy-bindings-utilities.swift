//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//  THIS FILE IS GENERATED BY EASY BINDINGS, DO NOT MODIFY IT
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

import Cocoa

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//  EBSignatureObserverProtocol
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

@objc(EBSignatureObserverProtocol) protocol EBSignatureObserverProtocol {
  func clearSignatureCache ()
  func signature () -> UInt32
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   EBWeakObserverSetElement
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

fileprivate struct EBWeakObserverSetElement {

  //····················································································································

  private weak var mObserver : EBEvent? = nil // SOULD BE WEAK

  //····················································································································

  fileprivate var observer : EBEvent? { return self.mObserver }

  //····················································································································

  init (observer : EBEvent) {
    mObserver = observer
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   EBWeakEventSet
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

struct EBWeakEventSet {

  //····················································································································

  fileprivate var mDictionary = [Int : EBWeakObserverSetElement] ()

  //····················································································································

  mutating func insert (_ inObserver : EBEvent) {
    let address : Int = inObserver.ebObjectIndex
    self.mDictionary [address] = EBWeakObserverSetElement (observer:inObserver)
  }

  //····················································································································

  mutating func remove (_ inObserver : EBEvent) {
    let address : Int = inObserver.ebObjectIndex
    self.mDictionary [address] = nil
  }

  //····················································································································

  mutating func apply (_ inFunction : (_ : EBEvent) -> Void) {
    for (key, entry) in self.mDictionary {
      if let observer = entry.observer {
        inFunction (observer)
      }else{
        self.mDictionary [key] = nil
      }
    }
  }

  //····················································································································

  var count : Int {
    var n = 0
    for (_, entry) in self.mDictionary {
      if entry.observer != nil {
        n += 1
      }
    }
    return n
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   EBAbstractProperty (abstract class)
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

class EBAbstractProperty : EBEvent {

  private final var mObservers = EBWeakEventSet ()

  //····················································································································

  final func addEBObserver (_ inObserver : EBEvent) {
    self.mObservers.insert (inObserver)
    self.updateObserverExplorer ()
    inObserver.postEvent ()
  }

  //····················································································································

  final func addEBObserversFrom (_ inObserverSet : inout EBWeakEventSet) {
    inObserverSet.apply ( {(_ observer : EBEvent) in
      self.mObservers.insert (observer)
      observer.postEvent ()
    })
    self.updateObserverExplorer ()
  }

  //····················································································································

  final func removeEBObserver (_ inObserver : EBEvent) {
    self.mObservers.remove (inObserver)
  //  inObserver.postEvent ()
    self.updateObserverExplorer ()
  }

  //····················································································································

  final func removeEBObserversFrom (_ inObserverSet : inout EBWeakEventSet) {
    inObserverSet.apply ( {(_ observer : EBEvent) in
      self.mObservers.remove (observer)
      observer.postEvent ()
    })
    self.updateObserverExplorer ()
  }

  //····················································································································

  override func postEvent () {
    self.mObservers.apply ( {(_ observer : EBEvent) in observer.postEvent () })
  }

  //····················································································································

  final var mObserverExplorer : NSPopUpButton? {
    didSet {
      self.updateObserverExplorer ()
    }
  }

  //····················································································································

  final func updateObserverExplorer () {
    if let observerExplorer = self.mObserverExplorer {
      observerExplorer.removeAllItems ()
      let observerCount = self.mObservers.count
      observerExplorer.addItem (withTitle: String (observerCount))
      observerExplorer.isEnabled = observerCount > 0
      self.mObservers.apply ( {(_ observer : EBEvent) in
        let stringValue = explorerIndexString (observer.ebObjectIndex) + observer.className
        observerExplorer.addItem (withTitle: stringValue)
      })
    }
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    EBObserver
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

class EBObserver : EBAbstractProperty {
  private var mPostEventFunction : Optional < () -> Void > = nil

  //····················································································································

  func setPostEventFunction (_ function : Optional < () -> Void >) {
    self.mPostEventFunction = function
  }

  //····················································································································

  override func postEvent() {
    self.mPostEventFunction? ()
    super.postEvent ()
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   presentErrorWindow
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

var gErrorWindows : [NSWindow] = []
var origin = NSPoint (x:20.0, y:20.0)

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func presentErrorWindow (_ file : String!,
                         _ line : Int,
                         _ errorMessage : String) {
  var message = ""
  message += "File: " + file + "\n"
  message += "Line: \(line)\n"
  message += "Message: " + errorMessage + "\n"
  let r = NSRect (origin:origin, size:NSSize (width:300.0, height:200.0))
  origin.x += 20.0 ;
  origin.y += 20.0 ;
  let window = NSWindow.init (
    contentRect:r,
    styleMask:[.titled, .closable],
    backing:NSWindow.BackingStoreType.buffered,
    defer:true
  )
  window.title = "Outlet Error"
  let contentView : NSView = window.contentView!
  let tfRect = NSInsetRect (contentView.bounds , 10.0, 10.0)
  let tf = NSTextField.init (frame:tfRect)
  tf.isEditable = false
  tf.isSelectable = true
  tf.font = NSFont.boldSystemFont (ofSize: 0.0)
  tf.textColor = NSColor.red
  tf.stringValue = message
  contentView.addSubview (tf)
  __NSBeep ()
  window.makeKeyAndOrderFront (nil)
  //---
  gErrorWindows.append (window)
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   Array<T> extension
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

extension Array {
  func objectAtIndex (_ index: Int, file: String, line: Int) -> Element {
    if index < 0 {
      NSLog ("Negative index %d in '%@' line %d", index, file, line)
    }else if index >= count {
      NSLog ("index %d >= count %d in '%@' line %d", index, count, file, line)
    }
    return self [index]
  }
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    EBValidationResult
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

enum EBValidationResult <T> {
  case ok (T /* validated value */)
  case rejectWithBeep
  case rejectWithAlert (String /* informativeText */)
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    EBUserClassNameProtocol protocol
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

@objc(EBUserClassNameProtocol) protocol EBUserClassNameProtocol {
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    EBTableCellView
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

class EBTableCellView : NSTableCellView, EBUserClassNameProtocol {
  final var mUnbindFunction : Optional < () -> Void > = nil

  //····················································································································

  required init? (coder: NSCoder) {
    super.init (coder:coder)
    noteObjectAllocation (self)
  }

  //····················································································································

  override init (frame:NSRect) {
    super.init (frame:frame)
    noteObjectAllocation (self)
  }

  //····················································································································

  deinit {
    noteObjectDeallocation (self)
  }

  //····················································································································

  override func removeFromSuperview () {
   // NSLog ("\(#function)")
    if !Thread.isMainThread {
      NSLog ("removeFromSuperview not in main thread")
    }
    self.mUnbindFunction? ()
    super.removeFromSuperview ()
  }

  //····················································································································

  override func removeFromSuperviewWithoutNeedingDisplay () {
   // NSLog ("\(#function)")
    if !Thread.isMainThread {
      NSLog ("removeFromSuperviewWithoutNeedingDisplay not in main thread")
    }
    self.mUnbindFunction? ()
    super.removeFromSuperviewWithoutNeedingDisplay ()
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    EBObject class
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

private var gEasyBindingsObjectIndex = 0

//······················································································································

class EBObject : NSObject, EBUserClassNameProtocol {
  let ebObjectIndex : Int

  //····················································································································

  override init () {
    ebObjectIndex = gEasyBindingsObjectIndex
    gEasyBindingsObjectIndex += 1
    super.init ()
    noteObjectAllocation (self)
  }

  //····················································································································

  deinit {
    noteObjectDeallocation (self)
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    EBSimpleClass class
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

class EBSimpleClass : EBObject {

  //····················································································································

  func populateExplorerWindow ( _ y : inout CGFloat, view : NSView) {
  }

  //····················································································································

  func clearObjectExplorer () {
  }

  //····················································································································

  func saveInto (dictionary : NSMutableDictionary) {
  }

  //····················································································································

  func setUp (withDictionary dictionary : NSDictionary) {
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   EBSimpleController
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

class EBSimpleController : EBOutletEvent {

  //····················································································································

  private let mPrivateObservedObjects : [EBAbstractProperty]

  //····················································································································

  init (observedObjects : [EBAbstractProperty]) {
    mPrivateObservedObjects = observedObjects
    super.init ()
    for object in observedObjects {
      object.addEBObserver (self)
    }
  }

  //····················································································································

  func unregister () {
    for object in self.mPrivateObservedObjects {
      object.removeEBObserver (self)
    }
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   EBReadOnlyClassController <T>
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

class EBReadOnlyClassController <T> : EBSimpleController {

  //····················································································································

  init (model : EBReadOnlyClassProperty <T>, callBack: @escaping () -> Void) {
    super.init (observedObjects:[model])
    self.mEventCallBack = callBack
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   EBReadOnlyValueController <T>
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

class EBReadOnlyValueController <T> : EBSimpleController {

  //····················································································································

  init (model : EBReadOnlyValueProperty <T>, callBack : @escaping () -> Void) {
    super.init (observedObjects: [model])
    self.mEventCallBack = callBack
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    createEntryForAttributeNamed
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

let EXPLORER_ROW_HEIGHT : CGFloat = 20.0
private let FIRST_COLUMN_WIDTH  : CGFloat = 60.0
private let SECOND_COLUMN_WIDTH : CGFloat = 400.0
private let THIRD_COLUMN_WIDTH  : CGFloat = 300.0

let EXPLORER_ROW_WIDTH : CGFloat = FIRST_COLUMN_WIDTH + SECOND_COLUMN_WIDTH + THIRD_COLUMN_WIDTH

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func titleColumn (_ y : CGFloat) -> NSRect {
  return NSRect (x:0.0, y:y, width:EXPLORER_ROW_WIDTH, height:EXPLORER_ROW_HEIGHT)
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func firstColumn (_ y : CGFloat) -> NSRect {
  return NSRect (x:0.0, y:y, width:FIRST_COLUMN_WIDTH, height:EXPLORER_ROW_HEIGHT)
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func secondColumn (_ y : CGFloat) -> NSRect {
  return NSRect (x:FIRST_COLUMN_WIDTH, y:y, width:SECOND_COLUMN_WIDTH, height:EXPLORER_ROW_HEIGHT)
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func thirdColumn (_ y : CGFloat) -> NSRect {
  return NSRect (x:FIRST_COLUMN_WIDTH + SECOND_COLUMN_WIDTH, y:y, width:THIRD_COLUMN_WIDTH, height:EXPLORER_ROW_HEIGHT)
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

private let explorerLetters = ["A", "B", "C", "D", "E", "F", "G", "H", "J", "K", "L",
                               "M", "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z"]

func explorerIndexString (_ idx : Int) -> String {
  var result = String (idx % 10)
  var n = idx / 10
  result += String (n % 10)
  n /= 10
  result += explorerLetters [n % explorerLetters.count]
  n /= explorerLetters.count
  result += explorerLetters [n % explorerLetters.count]
  n /= explorerLetters.count
  result += explorerLetters [n % explorerLetters.count]
  n /= explorerLetters.count
  if n > 0 {
    result += String (n)
  }
  return result + " — "
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func createEntryForPropertyNamed (_ attributeName : String,
                                  idx : Int,
                                  y : inout CGFloat,
                                  view : NSView,
                                  observerExplorer : inout NSPopUpButton?,
                                  valueExplorer : inout NSTextField?) {
  let font = NSFont.boldSystemFont (ofSize: NSFont.smallSystemFontSize)
//--- Explorer popup button
  observerExplorer = NSPopUpButton (frame:firstColumn (y), pullsDown:true)
  observerExplorer?.font = font
  view.addSubview (observerExplorer!)
//--- Property textfield
  let tf = NSTextField (frame:secondColumn (y))
  tf.isEnabled = true
  tf.isEditable = false
  tf.stringValue = explorerIndexString (idx) + attributeName
  tf.font = font
  view.addSubview (tf)
//--- Value textfield
  valueExplorer = NSTextField (frame:thirdColumn (y))
  valueExplorer?.isEnabled = true
  valueExplorer?.isEditable = false
  valueExplorer?.font = font
  view.addSubview (valueExplorer!)
//--- Update rect origin
  y += EXPLORER_ROW_HEIGHT
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func createEntryForTitle (_ title : String,
                          y : inout CGFloat,
                          view : NSView) {
  let font = NSFont.boldSystemFont (ofSize: NSFont.smallSystemFontSize)
//--- Title textfield
  let tf = NSTextField (frame:titleColumn (y))
  tf.isEnabled = true
  tf.isEditable = false
  tf.stringValue = title
  tf.font = font
  tf.backgroundColor = NSColor.lightGray
  tf.drawsBackground = true
  tf.isBordered = false
  view.addSubview (tf)
//--- Update rect origin
  y += EXPLORER_ROW_HEIGHT
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    createEntryForObjectNamed
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func createEntryForObjectNamed (_ name : String,
                                object : EBObject,
                                y : inout CGFloat,
                                view : NSView) {
  let font = NSFont.boldSystemFont (ofSize: NSFont.smallSystemFontSize)
//--- Property textfield
  let tf = NSTextField (frame:secondColumn (y))
  tf.isEnabled = true
  tf.isEditable = false
  tf.stringValue = name
  tf.font = font
  view.addSubview (tf)
//--- Value textfield
  let vtf = NSTextField (frame:thirdColumn (y))
  vtf.isEnabled = true
  vtf.isEditable = false
  vtf.stringValue = explorerIndexString (object.ebObjectIndex) + String (describing: type(of: object))
  vtf.font = font
  view.addSubview (vtf)
//--- Update rect origin
  y += EXPLORER_ROW_HEIGHT
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    createEntryForToOneRelationshipNamed
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func createEntryForToOneRelationshipNamed (_ relationshipName : String,
                                           idx : Int,
                                           y : inout CGFloat,
                                           view : NSView,
                                           valueExplorer : inout NSButton?) {
  let font = NSFont.boldSystemFont (ofSize: NSFont.smallSystemFontSize)
  let tf = NSTextField (frame:secondColumn (y))
  tf.isEnabled = true
  tf.isEditable = false
  tf.stringValue = explorerIndexString (idx) + relationshipName
  tf.font = font
  view.addSubview (tf)
  valueExplorer = NSButton (frame:thirdColumn (y))
  valueExplorer?.font = font
  view.addSubview (valueExplorer!)
  y += EXPLORER_ROW_HEIGHT
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    createEntryForToManyRelationshipNamed
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func createEntryForToManyRelationshipNamed (_ relationshipName : String,
                                            idx : Int,
                                            y : inout CGFloat,
                                            view : NSView,
                                            valueExplorer : inout NSPopUpButton?) {
  let font = NSFont.boldSystemFont (ofSize: NSFont.smallSystemFontSize)
  let tf = NSTextField (frame:secondColumn (y))
  tf.isEnabled = true
  tf.isEditable = false
  tf.stringValue = explorerIndexString (idx) + relationshipName
  tf.font = font
  view.addSubview (tf)
  valueExplorer = NSPopUpButton (frame:thirdColumn (y), pullsDown:true)
  valueExplorer?.font = font
  view.addSubview (valueExplorer!)
  y += EXPLORER_ROW_HEIGHT
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    defaultValidationFunction
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func defaultValidationFunction <T> (_ currentValue : T, proposedValue : T) -> EBValidationResult <T> {
  return EBValidationResult.ok (proposedValue)
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//   EBSelection
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

enum EBSelection <T> {
  case empty
  case multiple
  case single (T)

  func kind () -> EBPropertyKind {
    switch self {
    case .empty : return .noSelectionKind
    case .multiple : return .multipleSelectionKind
    case .single : return .singleSelectionKind
    }
  }
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

enum EBPropertyKind {
  case noSelectionKind
  case multipleSelectionKind
  case singleSelectionKind
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func &= ( left:inout EBPropertyKind, right:EBPropertyKind) {
  switch left {
  case .noSelectionKind : break
  case .multipleSelectionKind :
    if right == .noSelectionKind {
      left = .noSelectionKind
    }
  case .singleSelectionKind :
    switch right {
    case .noSelectionKind :
      left = .noSelectionKind
    case .multipleSelectionKind :
      left = .multipleSelectionKind
    case .singleSelectionKind :
      break
    }
  }
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

private func compareIntProperties (_ left:EBSelection <Int>,
                                   right:EBSelection <Int>,
                                   function : (Int, Int) -> Bool) -> EBSelection <Bool> {
  switch left {
  case .empty :
    return .empty
  case .multiple :
    switch right {
    case .empty :
      return .empty
    case .multiple, .single :
      return .multiple
    }
  case .single (let vg) :
    switch right {
    case .empty :
      return .empty
    case .multiple :
      return .multiple
    case .single (let vd) :
      return .single (function (vg, vd))
    }
  }
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func > (left:EBSelection<Int>, right:EBSelection<Int>) -> EBSelection<Bool> {
  return compareIntProperties (left, right: right, function: {$0 > $1})
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func >= (left:EBSelection<Int>, right:EBSelection<Int>) -> EBSelection<Bool> {
  return compareIntProperties (left, right: right, function: {$0 >= $1})
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func < (left:EBSelection<Int>, right:EBSelection<Int>) -> EBSelection<Bool> {
  return compareIntProperties (left, right: right, function: {$0 < $1})
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func <= (left:EBSelection<Int>, right:EBSelection<Int>) -> EBSelection<Bool> {
  return compareIntProperties (left, right: right, function: {$0 <= $1})
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func == (left:EBSelection<Int>, right:EBSelection<Int>) -> EBSelection<Bool> {
  return compareIntProperties (left, right: right, function: {$0 == $1})
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func != (left:EBSelection<Int>, right:EBSelection<Int>) -> EBSelection<Bool> {
  return compareIntProperties (left, right: right, function: {$0 != $1})
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

private func combineBoolProperties (_ left:EBSelection<Bool>,
                                     right:EBSelection<Bool>,
                                     function : (Bool, Bool) -> Bool) -> EBSelection<Bool> {
  switch left {
  case .empty :
    return .empty
  case .multiple :
    switch right {
    case .empty :
      return .empty
    case .multiple, .single :
      return .multiple
    }
  case .single (let vg) :
    switch right {
    case .empty :
      return .empty
    case .multiple :
      return .multiple
    case .single (let vd) :
      return .single (function (vg, vd))
    }
  }
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func && (left:EBSelection<Bool>, right:EBSelection<Bool>) -> EBSelection<Bool> {
  return combineBoolProperties (left, right: right, function: {$0 && $1})
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func || (left:EBSelection<Bool>, right:EBSelection<Bool>) -> EBSelection<Bool> {
  return combineBoolProperties (left, right: right, function: {$0 || $1})
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

func ^ (left:EBSelection<Bool>, right:EBSelection<Bool>) -> EBSelection<Bool> {
  return combineBoolProperties (left, right: right, function: {$0 != $1})
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

prefix func ! (operand:EBSelection<Bool>) -> EBSelection<Bool> {
  switch operand {
  case .empty :
    return .empty
  case .multiple :
    return .multiple
  case .single (let v) :
    return .single (!v)
  }
}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    ReadOnlyAbstractArrayProperty
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

class ReadOnlyAbstractArrayProperty <T : Hashable> : EBAbstractProperty {

  //····················································································································

  var prop : EBSelection < [T] > { get { return .empty } }

  //····················································································································

  weak var ebUndoManager : EBUndoManager? = nil // SOULD BE WEAK

  //····················································································································

  var propval : [T] { return [] } // Abstract method

  //····················································································································

  var propset : Set <T> { return Set () } // Abstract method (requires T to be hashable)

  //····················································································································

  final var count_property = EBTransientProperty_Int ()

  var count_property_selection : EBSelection <Int> {
    get {
      return self.count_property.prop
    }
  }

  //····················································································································

  override init () {
    super.init ()
    self.count_property.mReadModelFunction = { [weak self] in
      if let me = self {
        switch me.prop {
        case .empty :
          return .empty
        case .multiple :
          return .multiple
        case .single (let v) :
          return .single (v.count)
        }
      }else{
        return .empty
      }
    }
  }

  //····················································································································

  override func postEvent () {
    self.count_property.postEvent ()
    super.postEvent ()
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//    Data extension: comparable
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

extension Data : Comparable {

  //····················································································································

  static public func < (_ left : Data, _ right : Data) -> Bool {
    var result = left.count < right.count
    if left.count == right.count {
      var idx = 0
      while (idx < right.count) && !result {
        result = left [idx] < right [idx]
        idx += 1
      }
    }
    return result
  }

  //····················································································································

}

//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
