//-----------------------------------------------------------------------------*
//                                                                             *
//                           File 'MyRootEntity.m'                             *
//                     Generated by version 0.0.1 [debug]                      *
//                        june 4th, 2014, at 11h41'2"                          *
//                                                                             *
//-----------------------------------------------------------------------------*

//--- START OF USER ZONE 1


//--- END OF USER ZONE 1

#import "easy-bindings-utilities.h"
#import "PMAllocationDebug.h"
#import "PMEntityManager.h"
#import "PMRelationshipDescription.h"
#import "PMAttributeDescription.h"
#import "PMApplication.h"
#import "load-store-functions.h"
#import "MyRootEntity.h"
#import "NameEntity.h"


//-----------------------------------------------------------------------------*

@implementation MyRootEntity

//-----------------------------------------------------------------------------*
//    Synthesize properties                                                    *
//-----------------------------------------------------------------------------*

//--- Attributes

//--- To-one relationships

//--- To-many relationships
@synthesize mNames ; // Set of NameEntity entities

//-----------------------------------------------------------------------------*
//    Swizzle setters                                                          *
//-----------------------------------------------------------------------------*

+ (void) load {
  Method original ;
  Method swizzled ;
  original = class_getInstanceMethod (self, @selector (setMNames:)) ;
  swizzled = class_getInstanceMethod (self, @selector (setMNames_swizzled:)) ;
  macroCheckMethodSwizzling (original, swizzled) ;
  method_exchangeImplementations (original, swizzled) ;
}

//-----------------------------------------------------------------------------*
//    newInstanceWithManager:                                                  *
//-----------------------------------------------------------------------------*

+ (MyRootEntity *) newInstanceWithManager: (PMEntityManager *) inManager {
  return [inManager newInstanceOfEntity:[MyRootEntity class]] ;
}

//-----------------------------------------------------------------------------*
//    init                                                                     *
//-----------------------------------------------------------------------------*

- (instancetype) init {
  self = [super init] ;
  if (self) {
  //--- Attribute initialisation
  //--- To many relationship initialisation
    self.mNames = [NSMutableArray new] ;
  //--- Add Transient observers
  }
  return self ;
}

//-----------------------------------------------------------------------------*
//    buildAttributeDescriptionArray                                           *
//-----------------------------------------------------------------------------*

- (void) buildAttributeDescriptionArray: (NSMutableArray *) ioDescriptionArray {
  [super buildAttributeDescriptionArray:ioDescriptionArray] ;
}

//-----------------------------------------------------------------------------*
//    buildToOneRelationshipDescriptionArray                                   *
//-----------------------------------------------------------------------------*

- (void) buildToOneRelationshipDescriptionArray: (NSMutableArray *) ioDescriptionArray {
  [super buildToOneRelationshipDescriptionArray:ioDescriptionArray] ;
}

//-----------------------------------------------------------------------------*
//    buildToManyRelationshipDescriptionArray                                  *
//-----------------------------------------------------------------------------*

- (void) buildToManyRelationshipDescriptionArray: (NSMutableArray *) ioDescriptionArray {
  [super buildToManyRelationshipDescriptionArray:ioDescriptionArray] ;
  [ioDescriptionArray addObject:[PMRelationshipDescription
    descriptionWithRelationshipName:@"mNames"
    withOppositionRelationshipName:@"mRoot"
    withIsToManyOppositionRelationship:NO
  ]] ;
}

//-----------------------------------------------------------------------------*
//    resetBeforeDeletion                                                      *
//-----------------------------------------------------------------------------*

- (void) resetBeforeDeletion {
  mNames = nil ;
//--- Remove Transient observers
  [super resetBeforeDeletion] ;
}

//-----------------------------------------------------------------------------*
//    saveIntoDictionary                                                       *
//-----------------------------------------------------------------------------*

- (void) saveIntoDictionary: (NSMutableDictionary *) ioDictionary {
  [super saveIntoDictionary:ioDictionary] ;
  storeEntityArrayInDictionary (self.mNames, @"mNames", ioDictionary) ;
}

//-----------------------------------------------------------------------------*
//    setUpWithDictionary                                                      *
//-----------------------------------------------------------------------------*

- (void) setUpWithDictionary: (NSDictionary *) inDictionary
         withManagedEntityArray: (NSArray *) inManagedEntityArray {
  [super
    setUpWithDictionary:inDictionary
    withManagedEntityArray:inManagedEntityArray
  ] ;
  self.mNames = readEntityArrayFromDictionary (@"mNames", inDictionary, inManagedEntityArray) ;
}

//-----------------------------------------------------------------------------*
//    setMNames_swizzled       *
//-----------------------------------------------------------------------------*

- (void) setMNames_swizzled: (NSMutableArray *) inNewArray {
  NSMutableArray * currentArray = self.mNames ;
  if (inNewArray != currentArray) {
  //--- Register old value in undo manager
    [[self.undoManager prepareWithInvocationTarget:self]
      setMNames:currentArray
    ] ;
  //--- Store new value
    [self setMNames_swizzled :inNewArray] ;
  //--- Removed object set
    NSMutableSet * removedObjectSet = [NSMutableSet new] ;
    [removedObjectSet addObjectsFromArray:currentArray] ;
    [removedObjectSet minusSet:[NSSet setWithArray:inNewArray]] ;
    for (NameEntity * object in removedObjectSet) {
      object.mRoot = nil ;
    }
    macroReleaseSetToNil (removedObjectSet) ;
  //--- Added object set
    NSMutableSet * addedObjectSet = [NSMutableSet new] ;
    [addedObjectSet addObjectsFromArray:inNewArray] ;
    [addedObjectSet minusSet:[NSSet setWithArray:currentArray]] ;
    for (NameEntity * object in addedObjectSet) {
      object.mRoot = self ;
    }
    macroReleaseSetToNil (addedObjectSet) ;
  //--- Notify observers object count did change
    [mNames_observers makeObjectsPerformSelector:@selector (entity_2E_MyRootEntity_2E_mNames_didChange)] ;
  }
}

//-----------------------------------------------------------------------------*

- (void) insertObject: (NameEntity *) inObject
         inMNamesAtIndex: (NSUInteger) inIndex {
  const NSUInteger idx = [mNames indexOfObject:inObject] ;
  if (idx == NSNotFound) {
  //---
    [mNames insertObject:inObject atIndex:inIndex] ;
  //---
    [self.undoManager
      registerUndoWithTarget:self
      selector:@selector (removeObjectFromMNames:)
      object:inObject
    ] ;
  //---
    inObject.mRoot = self ;
  }else if (idx != inIndex) {

  }
//--- Notify observers object count did change
  [mNames_observers makeObjectsPerformSelector:@selector (entity_2E_MyRootEntity_2E_mNames_didChange)] ;
}

//-----------------------------------------------------------------------------*

- (void) removeObjectFromMNamesAtIndex: (NSUInteger) inIndex {
  NameEntity * removedObject = [mNames objectAtIndex:inIndex] ;
//--- Perform removing
  [mNames removeObjectAtIndex:inIndex] ;
//--- Register all object in undo manager
  [[self.undoManager prepareWithInvocationTarget:self]
    insertObject:removedObject
    inMNamesAtIndex:inIndex
  ] ;
//--- Reset inverse relationship
  removedObject.mRoot = nil ;
//--- Notify observers object count did change
  [mNames_observers makeObjectsPerformSelector:@selector (entity_2E_MyRootEntity_2E_mNames_didChange)] ;
}

//-----------------------------------------------------------------------------*

- (void) appendToMNames: (NameEntity *) inObject {
  if (! [self.mNames containsObject:inObject]) {
    [self
      insertObject:inObject
      inMNamesAtIndex:self.mNames.count
    ] ;
  }
}

//-----------------------------------------------------------------------------*

- (void) removeObjectFromMNames: (NameEntity *) inObject {
  const NSUInteger idx = [self.mNames indexOfObject:inObject] ;
  if (NSNotFound != idx) {
    [self removeObjectFromMNamesAtIndex:idx] ;
  }
}


//-----------------------------------------------------------------------------*

- (void) addObserverOf_mNames: (NSObject *) inObserver {
  if (nil == mNames_observers) {
    mNames_observers = [NSMutableSet new] ;
  }
  [mNames_observers addObject:inObserver] ;
  [NSApp sendAction:@selector (entity_2E_MyRootEntity_2E_mNames_didChange) to:inObserver from:self] ;
//  [inObserver performSelector:@selector (entity_2E_MyRootEntity_2E_mNames_didChange)] ;
}

//-----------------------------------------------------------------------------*

- (void) removeObserverOf_mNames: (NSObject *) inObserver {
  [mNames_observers removeObject:inObserver] ;
  [NSApp sendAction:@selector (entity_2E_MyRootEntity_2E_mNames_didChange) to:inObserver from:self] ;
//  [inObserver performSelector:@selector (entity_2E_MyRootEntity_2E_mNames_didChange)] ;
}

//-----------------------------------------------------------------------------*

//--- START OF USER ZONE 2

//--- END OF USER ZONE 2

@end
