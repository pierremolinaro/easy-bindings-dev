//---------------------------------------------------------------------------*
//                                                                           *
//                     File 'PMAbstractManagedObject.m'                      *
//                        Generated by version 1.0.0                         *
//                       june 23th, 2012, at 0h0'53"                         *
//                                                                           *
//---------------------------------------------------------------------------*

//--- START OF USER ZONE 1


//--- END OF USER ZONE 1

//
//  PMAbstractManagedObject.m
//
//  Created by Pierre Molinaro on 22/06/12.
//  Copyright (c) 2012 ECN / IRCCyN. All rights reserved.
//
//----------------------------------------------------------------------------*

#import "PMAbstractManagedObject.h"

//----------------------------------------------------------------------------*

@implementation PMAbstractManagedObject

//----------------------------------------------------------------------------*

- (id) initWithEntity:(NSEntityDescription *) inEntity
       insertIntoManagedObjectContext:(NSManagedObjectContext *) inMangedObjectContext {
  self = [super 
    initWithEntity:inEntity
    insertIntoManagedObjectContext:inMangedObjectContext
  ] ;
  if (self) {
    mTriggeredTransientSet = [NSMutableSet new] ;
    [self pmInstallObserversForTransients] ;
  }
  return self ;
}

//----------------------------------------------------------------------------*

- (void) pmInstallObserversForTransients {
}

//----------------------------------------------------------------------------*

- (void) pmNotifyChangeForTransientProperty: (NSString *) inPropertyName {
  // NSLog (@"%s, %@", __PRETTY_FUNCTION__, inPropertyName) ;
  [mTriggeredTransientSet addObject:inPropertyName] ;
  if (! mActionPosted) {
    mActionPosted = YES ;
    [[NSRunLoop currentRunLoop]
      performSelector:@selector (triggerTransient)
      target:self
      argument:nil
      order:1000000
      modes:[NSArray arrayWithObject:NSDefaultRunLoopMode]
    ] ;
  }
}

//----------------------------------------------------------------------------*

- (void) triggerTransient {
  // NSLog (@"%s", __PRETTY_FUNCTION__) ;
  mActionPosted = NO ;
  NSSet * triggeredTransientSet = mTriggeredTransientSet.copy ;
  [mTriggeredTransientSet removeAllObjects] ;
  for (NSString * key in triggeredTransientSet) {
    [self willChangeValueForKey:key] ;
    [self  didChangeValueForKey:key] ;
  }
}

//----------------------------------------------------------------------------*

@end
//--- START OF USER ZONE 2


//--- END OF USER ZONE 2


