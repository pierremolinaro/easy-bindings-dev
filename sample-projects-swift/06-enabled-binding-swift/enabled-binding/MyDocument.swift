//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————
//  THIS FILE IS GENERATED BY EASY BINDINGS, DO NOT MODIFY IT
//——————————————————————————————————————————————————————————————————————————————————————————————————————————————————————

import Cocoa

//—————————————————————————————————————————————————————————————————————————————————————————————————————————————————————*

@objc(MyDocument) class MyDocument : EBManagedDocument {

  //····················································································································
  //    Outlets
  //····················································································································

  @IBOutlet var docBoolCheckBox : EBSwitch?
  @IBOutlet var myButton : EBButton?

  //····················································································································
  //    Properties
  //····················································································································


  //····················································································································
  //    Transient properties
  //····················································································································

  var documentFilePath_property = EBTransientProperty_String ()
  var documentFilePath_property_selection : EBSelection <String> {
    return self.documentFilePath_property.prop
  }


  //····················································································································
  //    Transient arraies
  //····················································································································


  //····················································································································
  //    Array Controllers
  //····················································································································


  //····················································································································
  //    Selection Controllers
  //····················································································································


  //····················································································································
  //    Custom object Controllers
  //····················································································································


  //····················································································································
  //    Document file path
  //····················································································································
  // Cette méthode est appelée après tout enregistrement, qu'il y ait changement de nom ou pas.

  override var fileModificationDate : Date? {
    get {
      return super.fileModificationDate
    }
    set{
      super.fileModificationDate = newValue
      self.documentFilePath_property.postEvent ()
    }
  }

  //····················································································································

  func computeTransient_documentFilePath () -> String {
    var documentFilePath = ""
    if let url = self.fileURL {
      documentFilePath = url.path
    }
    return documentFilePath
  }

  //····················································································································
  //    populateExplorerWindow
  //····················································································································

  override func populateExplorerWindow (_ y : inout CGFloat, view : NSView) {
    super.populateExplorerWindow (&y, view:view)
  }

  //····················································································································
  //    windowNibName
  //····················································································································

  override var windowNibName: String {
    return "MyDocument"
  }

  //····················································································································
  //    rootEntityClassName
  //····················································································································

  override func rootEntityClassName () -> String {
    return "MyRootEntity"
  }

  //····················································································································
  //    rootObject
  //····················································································································

  var rootObject : MyRootEntity { get { return mRootObject as! MyRootEntity } }

  //····················································································································
  //    windowControllerDidLoadNib
  //····················································································································

  override func windowControllerDidLoadNib (_ aController: NSWindowController) {
  //--------------------------- Outlet checking
    if nil == docBoolCheckBox {
      presentErrorWindow (file: #file,
                              line: #line,
                              errorMessage: "the 'docBoolCheckBox' outlet is nil") ;
//    }else if !docBoolCheckBox!.isKindOfClass (EBSwitch) {
//      presentErrorWindow (file: #file,
//                              line: #line,
//                              errorMessage: "the 'docBoolCheckBox' outlet is not an instance of 'EBSwitch'") ;
    }
    if nil == myButton {
      presentErrorWindow (file: #file,
                              line: #line,
                              errorMessage: "the 'myButton' outlet is nil") ;
//    }else if !myButton!.isKindOfClass (EBButton) {
//      presentErrorWindow (file: #file,
//                              line: #line,
//                              errorMessage: "the 'myButton' outlet is not an instance of 'EBButton'") ;
    }
  //--------------------------- Array controllers
  //--------------------------- Selection controllers
  //--------------------------- Custom object controllers
  //--------------------------- Transient compute functions
    self.documentFilePath_property.readModelFunction = { return .single (self.computeTransient_documentFilePath ()) }
  //--------------------------- Install property observers for transients
  //--------------------------- Install regular bindings
    docBoolCheckBox?.bind_value (self.rootObject.docBool_property, file: #file, line: #line)
  //--------------------------- Install multiple bindings
    do{
      let controller = MultipleBindingController_enabled (
        computeFunction:{
          return (!self.rootObject.docBool_property_selection && g_Preferences!.prefBoolean_property_selection)
        },
        outlet:self.myButton
      )
      g_Preferences!.prefBoolean_property.addEBObserver (controller)
      self.rootObject.docBool_property.addEBObserver (controller)
      mController_myButton_enabled = controller
    }
  //--------------------------- Set targets / actions
  //--------------------------- Update display
    super.windowControllerDidLoadNib (aController)
    flushOutletEvents ()
  }

  //····················································································································
  //   removeWindowController
  //····················································································································

  override func removeUserInterface () {
  //--------------------------- Unbind regular bindings
    docBoolCheckBox?.unbind_value ()
  //--------------------------- Unbind multiple bindings
    g_Preferences!.prefBoolean_property.removeEBObserver (mController_myButton_enabled!)
    self.rootObject.docBool_property.removeEBObserver (mController_myButton_enabled!)
    mController_myButton_enabled = nil
  //--------------------------- Uninstall compute functions for transients
    self.documentFilePath_property.readModelFunction = nil
  //--------------------------- Unbind array controllers
  //--------------------------- Unbind selection controllers
  //--------------------------- Uninstall property observers for transients
  //--------------------------- Remove targets / actions
  //--------------------------- Clean up outlets
    self.docBoolCheckBox?.ebCleanUp ()
    self.myButton?.ebCleanUp ()
  }

  //····················································································································
  //    Multiple bindings controller
  //····················································································································

  fileprivate var mController_myButton_enabled : MultipleBindingController_enabled?

  //····················································································································

}

//—————————————————————————————————————————————————————————————————————————————————————————————————————————————————————*

