semantics abstractSyntaxTypes :

#-----------------------------------------------------------------------------*

abstract class @astDeclaration {
}

#-----------------------------------------------------------------------------*

list @astDeclarationList {
  @astDeclaration mDeclaration ;
}

#-----------------------------------------------------------------------------*

list @attributeList {
  @lstring mAttributeTypeName ;
  @lstring mAttributeName ;
  @abstractDefaultValue mDefaultValue ;
}

#----------------------------------------------------------------------------*

enum @deleteRuleEnum {
  nullifyDeleteRule, cascadeDeleteRule, denyDeleteRule
}

#----------------------------------------------------------------------------*

list @relationshipList {
  @bool mIsToMany ;
  @lstring mDestinationEntityName ;
  @lstring mRelationshipName ;
  @lstring mInverseRelationshipName ;
  @bool mInverseRelationIsToMany ;
  @deleteRuleEnum mDeleteRule ;
}

#----------------------------------------------------------------------------*

abstract class @abstractTransientDependency {
}

#----------------------------------------------------------------------------*

class @transientRootSignDependency extends @abstractTransientDependency {
  @location mDeclarationLocation ;
}

#----------------------------------------------------------------------------*

class @transientLocalDependency extends @abstractTransientDependency {
  @lstring mMasterName ;
  @bool mNamesCountOption ;
}

#----------------------------------------------------------------------------*

class @transientRootDependency extends @abstractTransientDependency {
  @lstring mMasterName ;
  @bool mNamesCountOption ;
}

#----------------------------------------------------------------------------*

class @transientControllerDependency extends @abstractTransientDependency {
  @lstring mControllerName ;
  @lstring mMasterName ;
}

#----------------------------------------------------------------------------*

class @transientPreferenceDependency extends @abstractTransientDependency {
  @lstring mPreferencesName ;
  @lstring mMasterName ;
}

#----------------------------------------------------------------------------*

list @dependanceList {
  @abstractTransientDependency mDependency ;
}

#----------------------------------------------------------------------------*

list @transientList {
  @lstring mTransientTypeName ;
  @lstring mTransientName ;
  @dependanceList mDependencyList ;
}

#----------------------------------------------------------------------------*

list @classArrayList {
  @lstring mElementClassName ;
  @lstring mArrayName ;
}

#----------------------------------------------------------------------------*

class @classDeclaration extends @astDeclaration {
  @lstring mClassName ;
  @lstring mSuperClassName ;
  @attributeList mAttributeList ;
  @classArrayList mArrayList ;
  @transientList mTransientList ;
}

#----------------------------------------------------------------------------*

class @entityDeclaration extends @astDeclaration {
  @lstring mEntityName ;
  @lstring mSuperEntityName ;
  @attributeList mAttributeList ;
  @transientList mTransientList ;
  @relationshipList mRelationshipList ;
  @lstringlist mSignList ;
}

#----------------------------------------------------------------------------*

list @outletBindingOptionList {
  @lstring mOptionName ;
  @abstractDefaultValue mDefaultValue ;
}

#----------------------------------------------------------------------------*

abstract class @abstractBinding {
}

#----------------------------------------------------------------------------*

class @regularRootBinding, @regularSelfBinding extends @abstractBinding {
  @lstring mBindingName ;
  @lstring mObservableAttributeName ;
  @outletBindingOptionList mOutletBindingOptionList ;
  @bool mNamesCountOption ;
}

#----------------------------------------------------------------------------*

class @regularControllerBinding extends @abstractBinding {
  @lstring mBindingName ;
  @lstring mControllerName ;
  @lstring mControllerAttributeName ;
  @outletBindingOptionList mOutletBindingOptionList ;
  @bool mNamesCountOption ;
}

#----------------------------------------------------------------------------*

class @regularControllerSelectionBinding extends @abstractBinding {
  @lstring mBindingName ;
  @lstring mControllerName ;
  @lstring mControllerAttributeName ;
  @outletBindingOptionList mOutletBindingOptionList ;
}

#----------------------------------------------------------------------------*

class @regularPreferenceBinding extends @abstractBinding {
  @lstring mBindingName ;
  @lstring mPreferenceName ;
  @lstring mPreferenceAttributeName ;
  @outletBindingOptionList mOutletBindingOptionList ;
}

#----------------------------------------------------------------------------*

abstract class @multiValuedBindingBoundModel {
  @lstring mPropertyName ;
}

#----------------------------------------------------------------------------*

class @multiValuedBindingBoundToRoot,
      @multiValuedBindingBoundToSelf extends @multiValuedBindingBoundModel {
}

#----------------------------------------------------------------------------*

class @multiValuedBindingBoundToPref extends @multiValuedBindingBoundModel {
  @lstring mPreferenceName ;
}

#----------------------------------------------------------------------------*

class @multiValuedBindingBoundToController extends @multiValuedBindingBoundModel {
  @lstring mControllerName ;
}

#----------------------------------------------------------------------------*

class @multiValuedBindingBoundToControllerSelection extends @multiValuedBindingBoundModel {
  @lstring mControllerName ;
}

#----------------------------------------------------------------------------*

list @multiValuedBindingList {
  @bool mNegate ;
  @multiValuedBindingBoundModel mBoundModel ;
  @outletBindingOptionList mOutletBindingOptionList ;
}

#----------------------------------------------------------------------------*

class @multiValuedBinding extends @abstractBinding {
  @lstring mBindingName ;
  @multiValuedBindingList mMultiValuedBindingList ;
}

#----------------------------------------------------------------------------*

class @runBinding extends @abstractBinding {
  @lstring mTargetName ;
  @lstring mActionName ;
}

#----------------------------------------------------------------------------*

list @tableValueColumnBinding {
  @lstring mColumnName ;
  @lstring mCellTypeName ;
  @lstring mBoundPropertyName ;
}

#----------------------------------------------------------------------------*

class @tableValueBinding extends @abstractBinding {
  @lstring mControllerName ;
  @tableValueColumnBinding mTableValueColumnBinding ;
}

#----------------------------------------------------------------------------*

list @bindingList {
  @abstractBinding mBinding ;
}

#----------------------------------------------------------------------------*

list @outletDeclarationList {
  @lstring mOutletType ;
  @lstring mOutletName ;
  @bindingList mOutletBindingList ;
}

#----------------------------------------------------------------------------*

class @preferencesDeclaration extends @astDeclaration {
  @lstring mPreferencesName ;
  @outletDeclarationList mOutletDeclarationList ;
  @attributeList mAttributeList ;
  @transientList mTransientList ;
  @lstringlist mActionDeclarationList ;
  @controllerList mControllerList ;
  @classArrayList mArrayList ;
}

#----------------------------------------------------------------------------*

class @nibClassDeclaration extends @astDeclaration {
  @lstring mClassName ;
  @outletDeclarationList mOutletDeclarationList ;
  @attributeList mAttributeList ;
  @transientList mTransientList ;
  @lstringlist mActionDeclarationList ;
  @controllerList mControllerList ;
  @classArrayList mArrayList ;
}

#----------------------------------------------------------------------------*

list @controllerList {
  @controllerKind mControllerKind ;
  @lstring mControllerClassName ;
  @lstring mControllerName ;
  @lbool mIsRootObject ; # false -> is self object
  @lstring mControlledObjectName ;
  @outletBindingOptionList mControlledObjectBindingOptionList ;
  @bindingList mControllerBindingList ;
#--- Only for tree controllers ; for others, ["" nowhere]
  @lstring mChildRelationshipName ;
  @lstring mIsLeafAttributeName ;
}

#----------------------------------------------------------------------------*

class @documentDeclaration extends @astDeclaration {
  @lstring mDocumentName ;
  @lstring mRootEntityName ;
  @outletDeclarationList mOutletDeclarationList ;
  @controllerList mControllerList ;
  @lstringlist mActionDeclarationList ;
  @transientList mTransientList ;
  @attributeList mAttributeList ;
}

#----------------------------------------------------------------------------*

enum @formatterEnum {
  noFormatter, numberFormatter, dateFormatter
}

#----------------------------------------------------------------------------*

list @attributeASTTypeAndFormatterList {
  @lstring mTypeName ;
  @formatterEnum mRequiredFormatter ;
}

#----------------------------------------------------------------------------*

list @outletClassBindingList {
  @lstring mBindingName ;
  @attributeASTTypeAndFormatterList mAcceptableTypeFormatterList ;
  @bindingOptionList mBindingOptionList ;
}

#----------------------------------------------------------------------------*

list @bindingOptionList {
  @lstring mBindingOptionName ;
  @lstringlist mAcceptableTypeList ;
}

#----------------------------------------------------------------------------*

enum @generationKind {
  fullGeneration, generateImport, noGeneration
}

#----------------------------------------------------------------------------*

list @cursorList {
  @lstring mCursorName ;
  @ldouble mHotSpotX ;
  @ldouble mHotSpotY ;
}

#----------------------------------------------------------------------------*

class @outletClassDeclaration extends @astDeclaration {
  @lstring mOutletClassName ;
  @lstring mSuperClassName ;
  @lstringlist mAdoptedProtocolList ;
  @generationKind mGenerationKind ;
  @outletClassBindingList mOutletClassBindingList ;
  @bool mHasTableValueBinding ;
  @lstringlist mOptionList ;
}

#----------------------------------------------------------------------------*

list @controllerObservablePropertyList {
  @lstring mTypeName ;
  @lstring mPropertyName ;
}

#----------------------------------------------------------------------------*

class @protocolDeclaration extends @astDeclaration {
  @bool mIsPredefined ; # Generate import otherwise
  @lstring mProtocolName ;
}

#----------------------------------------------------------------------------*

enum @controllerKind {
  simpleController,
  objectController, # NSObjectController
  arrayController,  # NSArrayController
  entityController, # PMEntityController
  entityArrayController, # PMEntityArrayController
  treeController # NSTreeController
}

#----------------------------------------------------------------------------*

class @controllerClassDeclaration extends @astDeclaration {
  @controllerKind mControllerKind ;
  @lstring mControllerClassName ;
  @bindingOptionList mControlledObjectBindingOptionList ;
  @generationKind mGenerationKind ;
  @outletClassBindingList mBindingList ;
  @lstringlist mActionDeclarationList ;
  @controllerObservablePropertyList mControllerObservablePropertyList ;
}

#----------------------------------------------------------------------------*

class @enumDeclaration extends @astDeclaration {
  @lstring mEnumTypeName ;
  @lstringlist mEnumConstantNameList ;
}

#----------------------------------------------------------------------------*

abstract class @abstractDefaultValue {
}

#----------------------------------------------------------------------------*

class @boolAsDefaultValue extends @abstractDefaultValue {
  @lbool mValue ;
}

#----------------------------------------------------------------------------*

class @doubleAsDefaultValue extends @abstractDefaultValue {
  @ldouble mValue ;
}

#----------------------------------------------------------------------------*

class @integerAsDefaultValue extends @abstractDefaultValue {
  @luint mValue ;
}

#----------------------------------------------------------------------------*

class @stringAsDefaultValue extends @abstractDefaultValue {
  @lstring mValue ;
}

#----------------------------------------------------------------------------*

class @identifierAsDefaultValue extends @abstractDefaultValue {
  @lstring mValue ;
}

#----------------------------------------------------------------------------*

list @defaultValueList {
  @abstractDefaultValue mDefaultValue ;
}

#----------------------------------------------------------------------------*

class @listAsDefaultValue extends @abstractDefaultValue {
  @location mStartLocation ;
  @defaultValueList mDefaultValueList ;
}

#----------------------------------------------------------------------------*

list @structFieldASTList {
  @lstring mFieldTypeName ;
  @lstring mFieldName ;
}

#----------------------------------------------------------------------------*

enum @typeKind {
  classType,
  controllerClassType,
  documentType,
  entityType,
  enumType,
  nibClassType,
  outletClassType,
  preferencesType,
  protocolType,
  structType,
#--- Predefined Type
  boolType,
  integerType,
  uintegerType,
  doubleType,
  stringType,
  colorType,
  dataType,
  dateType,
  fontType,
  imageType,
  menuType,
  bezierPathType
}

#----------------------------------------------------------------------------*

reader @typeKind name -> @string outResult :
  switch selfcopy
  when classType : outResult := "classType" ;
  when controllerClassType : outResult := "controllerClassType" ;
  when documentType : outResult := "documentType" ;
  when entityType : outResult := "entityType" ;
  when enumType : outResult := "enumType" ;
  when nibClassType : outResult := "nibClassType" ;
  when outletClassType : outResult := "outletClassType" ;
  when preferencesType : outResult := "preferencesType" ;
  when protocolType : outResult := "protocolType" ;
  when structType : outResult := "structType" ;
  when boolType : outResult := "boolType" ;
  when integerType : outResult := "integerType" ;
  when uintegerType : outResult := "uintegerType" ;
  when doubleType : outResult := "doubleType" ;
  when stringType : outResult := "stringType" ;
  when colorType : outResult := "colorType" ;
  when dataType : outResult := "dataType" ;
  when dateType : outResult := "dateType" ;
  when fontType : outResult := "fontType" ;
  when imageType : outResult := "imageType" ;
  when menuType : outResult := "menuType" ;
  when bezierPathType : outResult := "bezierPathType" ;
  end switch ;
end reader ;

#----------------------------------------------------------------------------*

class @predefinedTypeDeclaration extends @astDeclaration {
  @string mTypeName ;
  @typeKind mKind ;
}

#----------------------------------------------------------------------------*

class @structDeclaration extends @astDeclaration {
  @lstring mStructTypeName ;
  @structFieldASTList mFieldList ;
}

#----------------------------------------------------------------------------*

end semantics ;
