//-----------------------------------------------------------------------------*
//                                                                             *
//                         File 'structAnalysis.cpp'                           *
//                         Generated by version 2.6.0                          *
//                        july 15th, 2014, at 20h9'47"                         *
//                                                                             *
//-----------------------------------------------------------------------------*

//--- START OF USER ZONE 1


//--- END OF USER ZONE 1

#include "galgas2/C_Compiler.h"
#include "galgas2/C_galgas_io.h"
#include "galgas2/C_galgas_CLI_Options.h"
#include "utilities/C_PrologueEpilogue.h"

//-----------------------------------------------------------------------------*

#include "structAnalysis.h"


//-----------------------------------------------------------------------------*
//                                                                             *
//        Overriding category method '@structDeclaration typeInventory'        *
//                                                                             *
//-----------------------------------------------------------------------------*

static void categoryMethod_structDeclaration_typeInventory (const cPtr_astDeclaration * inObject,
                                                            GALGAS_unifiedTypeMap & ioArgument_ioUnifiedTypeMap,
                                                            C_Compiler * inCompiler
                                                            COMMA_UNUSED_LOCATION_ARGS) {
  const cPtr_structDeclaration * object = (const cPtr_structDeclaration *) inObject ;
  macroValidSharedObject (object, cPtr_structDeclaration) ;
  cEnumerator_structFieldASTList enumerator_254 (object->mAttribute_mFieldList, kEnumeration_up) ;
  while (enumerator_254.hasCurrentObject ()) {
    {
    ioArgument_ioUnifiedTypeMap.modifier_enterEdge (object->mAttribute_mStructTypeName, enumerator_254.current_mFieldTypeName (HERE) COMMA_SOURCE_FILE ("structAnalysis.gSemantics", 10)) ;
    }
    enumerator_254.gotoNextObject () ;
  }
  {
  const GALGAS_structDeclaration temp_0 = object ;
  ioArgument_ioUnifiedTypeMap.modifier_insertKey (object->mAttribute_mStructTypeName, GALGAS_ebType::constructor_new (object->mAttribute_mStructTypeName, GALGAS_typeKind::constructor_structType (SOURCE_FILE ("structAnalysis.gSemantics", 17))  COMMA_SOURCE_FILE ("structAnalysis.gSemantics", 17)), temp_0, inCompiler COMMA_SOURCE_FILE ("structAnalysis.gSemantics", 15)) ;
  }
}
//-----------------------------------------------------------------------------*

static void defineCategoryMethod_structDeclaration_typeInventory (void) {
  enterCategoryMethod_typeInventory (kTypeDescriptor_GALGAS_structDeclaration.mSlotID,
                                     categoryMethod_structDeclaration_typeInventory) ;
}

//-----------------------------------------------------------------------------*

C_PrologueEpilogue gMethod_structDeclaration_typeInventory (defineCategoryMethod_structDeclaration_typeInventory, NULL) ;

//-----------------------------------------------------------------------------*
//                                                                             *
// Overriding category method '@structDeclaration buildObservablePropertyMap'  *
//                                                                             *
//-----------------------------------------------------------------------------*

static void categoryMethod_structDeclaration_buildObservablePropertyMap (const cPtr_astDeclaration * /* inObject */,
                                                                         const GALGAS_unifiedTypeMap /* constinArgument_inUnifiedTypeMap */,
                                                                         GALGAS_observablePropertyMapMap & /* ioArgument_ioObservablePropertyMapMap */,
                                                                         GALGAS_transientDependencyGraph & /* ioArgument_ioTransientDependencyGraph */,
                                                                         C_Compiler * /* inCompiler */
                                                                         COMMA_UNUSED_LOCATION_ARGS) {
}
//-----------------------------------------------------------------------------*

static void defineCategoryMethod_structDeclaration_buildObservablePropertyMap (void) {
  enterCategoryMethod_buildObservablePropertyMap (kTypeDescriptor_GALGAS_structDeclaration.mSlotID,
                                                  categoryMethod_structDeclaration_buildObservablePropertyMap) ;
}

//-----------------------------------------------------------------------------*

C_PrologueEpilogue gMethod_structDeclaration_buildObservablePropertyMap (defineCategoryMethod_structDeclaration_buildObservablePropertyMap, NULL) ;

//-----------------------------------------------------------------------------*
//                                                                             *
//      Overriding category method '@structDeclaration semanticAnalysis'       *
//                                                                             *
//-----------------------------------------------------------------------------*

static void categoryMethod_structDeclaration_semanticAnalysis (const cPtr_astDeclaration * inObject,
                                                               const GALGAS_unifiedTypeMap constinArgument_inUnifiedTypeMap,
                                                               GALGAS_contextAnalysisStruct & ioArgument_ioContextAnalysisStruct,
                                                               GALGAS_generationList & ioArgument_ioGenerationList,
                                                               C_Compiler * inCompiler
                                                               COMMA_UNUSED_LOCATION_ARGS) {
  const cPtr_structDeclaration * object = (const cPtr_structDeclaration *) inObject ;
  macroValidSharedObject (object, cPtr_structDeclaration) ;
  GALGAS_structFieldList var_structFieldList = GALGAS_structFieldList::constructor_emptyList (SOURCE_FILE ("structAnalysis.gSemantics", 38)) ;
  GALGAS_stringset var_headerFileInclusionSet = GALGAS_stringset::constructor_emptySet (SOURCE_FILE ("structAnalysis.gSemantics", 39)) ;
  cEnumerator_structFieldASTList enumerator_1213 (object->mAttribute_mFieldList, kEnumeration_up) ;
  while (enumerator_1213.hasCurrentObject ()) {
    GALGAS_ebType var_type ;
    GALGAS_astDeclaration joker_1280_0 ; // Joker input parameter
    constinArgument_inUnifiedTypeMap.method_searchKey (enumerator_1213.current_mFieldTypeName (HERE), var_type, joker_1280_0, inCompiler COMMA_SOURCE_FILE ("structAnalysis.gSemantics", 41)) ;
    const enumGalgasBool test_0 = categoryReader_isPODtype (var_type, inCompiler COMMA_SOURCE_FILE ("structAnalysis.gSemantics", 42)).operator_not (SOURCE_FILE ("structAnalysis.gSemantics", 42)).boolEnum () ;
    if (kBoolTrue == test_0) {
      GALGAS_location location_1 (enumerator_1213.current_mFieldName (HERE).reader_location (HERE)) ; // Implicit use of 'location' reader
      inCompiler->emitSemanticError (location_1, GALGAS_string ("only a POD type is allowed in a structure")  COMMA_SOURCE_FILE ("structAnalysis.gSemantics", 43)) ;
    }
    const enumGalgasBool test_2 = GALGAS_bool (kIsEqual, var_type.reader_mKind (SOURCE_FILE ("structAnalysis.gSemantics", 45)).objectCompare (GALGAS_typeKind::constructor_enumType (SOURCE_FILE ("structAnalysis.gSemantics", 45)))).boolEnum () ;
    if (kBoolTrue == test_2) {
      var_headerFileInclusionSet.addAssign_operation (var_type.reader_mTypeName (SOURCE_FILE ("structAnalysis.gSemantics", 46)).mAttribute_string  COMMA_SOURCE_FILE ("structAnalysis.gSemantics", 46)) ;
    }else if (kBoolFalse == test_2) {
      const enumGalgasBool test_3 = GALGAS_bool (kIsEqual, var_type.reader_mKind (SOURCE_FILE ("structAnalysis.gSemantics", 47)).objectCompare (GALGAS_typeKind::constructor_structType (SOURCE_FILE ("structAnalysis.gSemantics", 47)))).boolEnum () ;
      if (kBoolTrue == test_3) {
        var_headerFileInclusionSet.addAssign_operation (var_type.reader_mTypeName (SOURCE_FILE ("structAnalysis.gSemantics", 48)).mAttribute_string  COMMA_SOURCE_FILE ("structAnalysis.gSemantics", 48)) ;
      }
    }
    var_structFieldList.addAssign_operation (var_type, enumerator_1213.current_mFieldName (HERE).mAttribute_string  COMMA_SOURCE_FILE ("structAnalysis.gSemantics", 50)) ;
    enumerator_1213.gotoNextObject () ;
  }
  {
  ioArgument_ioContextAnalysisStruct.mAttribute_mStructTypeMap.modifier_insertKey (object->mAttribute_mStructTypeName, var_structFieldList, inCompiler COMMA_SOURCE_FILE ("structAnalysis.gSemantics", 53)) ;
  }
  ioArgument_ioGenerationList.addAssign_operation (GALGAS_structTypeGeneration::constructor_new (object->mAttribute_mStructTypeName.mAttribute_string, var_structFieldList, var_headerFileInclusionSet  COMMA_SOURCE_FILE ("structAnalysis.gSemantics", 58))  COMMA_SOURCE_FILE ("structAnalysis.gSemantics", 58)) ;
}
//-----------------------------------------------------------------------------*

static void defineCategoryMethod_structDeclaration_semanticAnalysis (void) {
  enterCategoryMethod_semanticAnalysis (kTypeDescriptor_GALGAS_structDeclaration.mSlotID,
                                        categoryMethod_structDeclaration_semanticAnalysis) ;
}

//-----------------------------------------------------------------------------*

C_PrologueEpilogue gMethod_structDeclaration_semanticAnalysis (defineCategoryMethod_structDeclaration_semanticAnalysis, NULL) ;

//--- START OF USER ZONE 2


//--- END OF USER ZONE 2


